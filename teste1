-- Script Local - Brainrot Server & Position GUI (corrigido e robusto)
-- Jogo alvo: Steal a Brainrot (placeId abaixo). Ajuste GameID se precisar.
-- Observa√ß√£o: executores precisam ter HttpRequest/HttpGet habilitado.

if game.CoreGui:FindFirstChild("BrainrotHub") then
    game.CoreGui.BrainrotHub:Destroy()
end

-- Servi√ßos
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

local GameID = 109983668079237 -- ajuste se necess√°rio

-- Utility: notifica√ß√£o segura
local function Notify(title, text, duration)
    pcall(function()
        StarterGui:SetCore("SendNotification", {Title = title or "Info", Text = text or "", Duration = duration or 3})
    end)
end

-- Busca servidores p√∫blicos usando pagina√ß√£o (limitado a algumas p√°ginas para evitar loop infinito)
local function BuscarServidores(limitPages)
    limitPages = limitPages or 5
    local servidores = {}
    local cursor = nil
    for page = 1, limitPages do
        local url
        if cursor and cursor ~= "" then
            url = ("https://games.roblox.com/v1/games/%d/servers/Public?limit=100&cursor=%s"):format(GameID, tostring(cursor))
        else
            url = ("https://games.roblox.com/v1/games/%d/servers/Public?limit=100"):format(GameID)
        end

        local ok, res = pcall(function() return game:HttpGet(url) end)
        if not ok or not res then
            break
        end

        local success, data = pcall(function() return HttpService:JSONDecode(res) end)
        if not success or not data then
            break
        end

        if type(data.data) == "table" then
            for _, s in ipairs(data.data) do
                -- coleta info √∫til (n√£o filtra por lota√ß√£o aqui)
                table.insert(servidores, s)
            end
        end

        if data.nextPageCursor then
            cursor = data.nextPageCursor
        else
            break
        end
    end

    return servidores
end

-- Procura um servidor cujo nome/description contenha a string 'valor' (case-insensitive).
-- Se valor == "" -> retorna um servidor aleat√≥rio dispon√≠vel.
local function EncontrarServidorPorValor(valor)
    valor = tostring(valor or "")
    local servidores = BuscarServidores(6) -- at√© 6 p√°ginas
    if #servidores == 0 then
        return nil
    end

    if valor ~= "" then
        local alvo = nil
        local low = string.lower(valor)
        for _, s in ipairs(servidores) do
            -- prote√ß√£o: alguns campos podem n√£o existir; concatena poss√≠veis campos
            local name = tostring(s.name or "")
            local desc = tostring(s.description or "")
            local display = string.lower(name .. " " .. desc)
            if string.find(display, low, 1, true) then
                alvo = s
                break
            end
            -- Tamb√©m tenta procurar por campos que alguns endpoints apresentam
            if s.id and tostring(s.id) == valor then
                alvo = s
                break
            end
        end

        if alvo then
            return alvo
        end
    end

    -- se n√£o achou por valor, retorna um servidor aleat√≥rio com slots livres
    local candidatos = {}
    for _, s in ipairs(servidores) do
        -- garantir que tenha players < maxPlayers (evita servidores cheios)
        if (s.playing or 0) < (s.maxPlayers or 0) then
            table.insert(candidatos, s)
        end
    end
    if #candidatos == 0 then -- se nenhum com espa√ßo, aceita qualquer servidor
        candidatos = servidores
    end
    if #candidatos == 0 then
        return nil
    end
    return candidatos[math.random(1, #candidatos)]
end

-- Teleporta para uma inst√¢ncia (se poss√≠vel)
local function TeleportParaValor(valor)
    spawn(function()
        Notify("üåê Buscando servidor...", "Procurando servidores - aguarde", 4)
        local sucesso, alvo = pcall(EncontrarServidorPorValor, valor)
        if not sucesso or not alvo then
            Notify("‚ùå Falha ao buscar servidores", "Nenhum servidor encontrado", 4)
            return
        end

        local instanceId = alvo.id or alvo.id -- alguns resultados usam "id"
        if not instanceId then
            -- fallback: tentar teleport normal (sem inst√¢ncia espec√≠fica)
            pcall(function()
                Notify("üåê Teleportando (fallback)...", "Entrando no jogo.", 3)
                TeleportService:Teleport(GameID, LocalPlayer)
            end)
            return
        end

        Notify("üåê Teleportando...", ("Entrando no servidor %s"):format(tostring(valor ~= "" and valor or "aleat√≥rio")), 4)
        local ok, err = pcall(function()
            TeleportService:TeleportToPlaceInstance(GameID, instanceId, LocalPlayer)
        end)
        if not ok then
            Notify("‚ùå Erro ao teleportar", tostring(err or "unknown"), 5)
        end
    end)
end

-- ---------- GUI ----------
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "BrainrotHub"
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 420, 0, 300)
MainFrame.Position = UDim2.new(0.5, -210, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,10)

local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, -10, 0, 36)
Title.Position = UDim2.new(0,10,0,6)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.Text = "üåê Servidores Brainrot"

local CloseBtn = Instance.new("TextButton", MainFrame)
CloseBtn.Size = UDim2.new(0,30,0,30)
CloseBtn.Position = UDim2.new(1, -40, 0, 6)
CloseBtn.Text = "‚úñ"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 18
CloseBtn.BackgroundColor3 = Color3.fromRGB(80,20,20)
CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", CloseBtn)
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

local ContentFrame = Instance.new("Frame", MainFrame)
ContentFrame.Position = UDim2.new(0,10,0,48)
ContentFrame.Size = UDim2.new(1,-20,1,-58)
ContentFrame.BackgroundTransparency = 1

local ServerFrame = Instance.new("Frame", ContentFrame)
ServerFrame.Size = UDim2.new(1,0,1,0)
ServerFrame.BackgroundTransparency = 1
ServerFrame.Visible = true

local UIList = Instance.new("UIListLayout", ServerFrame)
UIList.Padding = UDim.new(0,8)
UIList.SortOrder = Enum.SortOrder.LayoutOrder

-- bot√£o helper
local function CriarBotao(parent, texto, tamanho, posY)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0, 360, 0, 44)
    btn.BackgroundColor3 = Color3.fromRGB(45,45,45)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = texto
    Instance.new("UICorner", btn)
    return btn
end

local btn60 = CriarBotao(ServerFrame, "üß† Brainrots 60M", 44)
local btn50 = CriarBotao(ServerFrame, "üß† Brainrots 50M", 44)
local btnQuick = CriarBotao(ServerFrame, "‚ö° Buscar R√°pido", 44)
local btnNext = CriarBotao(ServerFrame, "‚û° Pr√≥ximo", 44)

btn60.MouseButton1Click:Connect(function()
    TeleportParaValor("60m")
end)
btn50.MouseButton1Click:Connect(function()
    TeleportParaValor("50m")
end)
btnQuick.MouseButton1Click:Connect(function()
    TeleportParaValor("") -- aleat√≥rio
end)

-- Aba 2: salvar/voltar posi√ß√£o
local SaveFrame = Instance.new("Frame", ContentFrame)
SaveFrame.Size = UDim2.new(1,0,1,0)
SaveFrame.BackgroundTransparency = 1
SaveFrame.Visible = false

local SaveList = Instance.new("UIListLayout", SaveFrame)
SaveList.Padding = UDim.new(0,8)

local SaveBtn = Instance.new("TextButton", SaveFrame)
SaveBtn.Size = UDim2.new(0, 360, 0, 44)
SaveBtn.Position = UDim2.new(0,0,0,0)
SaveBtn.BackgroundColor3 = Color3.fromRGB(40,80,40)
SaveBtn.Font = Enum.Font.GothamBold
SaveBtn.TextSize = 16
SaveBtn.TextColor3 = Color3.fromRGB(255,255,255)
SaveBtn.Text = "üíæ Salvar Posi√ß√£o"
Instance.new("UICorner", SaveBtn)

local BackPosBtn = Instance.new("TextButton", SaveFrame)
BackPosBtn.Size = UDim2.new(0, 360, 0, 44)
BackPosBtn.BackgroundColor3 = Color3.fromRGB(80,40,40)
BackPosBtn.Font = Enum.Font.GothamBold
BackPosBtn.TextSize = 16
BackPosBtn.TextColor3 = Color3.fromRGB(255,255,255)
BackPosBtn.Text = "‚Ü© Voltar para Posi√ß√£o"
Instance.new("UICorner", BackPosBtn)

local BackToServersBtn = Instance.new("TextButton", SaveFrame)
BackToServersBtn.Size = UDim2.new(0, 160, 0, 36)
BackToServersBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
BackToServersBtn.Font = Enum.Font.GothamBold
BackToServersBtn.TextSize = 14
BackToServersBtn.TextColor3 = Color3.fromRGB(255,255,255)
BackToServersBtn.Text = "‚¨Ö Voltar"
Instance.new("UICorner", BackToServersBtn)

-- logica salvar/voltar
local savedCFrame = nil
local backDebounce = false

SaveBtn.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if not char then
        Notify("‚ùå Erro", "Personagem n√£o carregado.", 3)
        return
    end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then
        Notify("‚ùå Erro", "HumanoidRootPart n√£o encontrado.", 3)
        return
    end
    savedCFrame = hrp.CFrame
    backDebounce = false
    Notify("‚úÖ Posi√ß√£o salva", "Voc√™ pode voltar para ela com o bot√£o Voltar.", 3)
end)

BackPosBtn.MouseButton1Click:Connect(function()
    if backDebounce then
        return
    end
    if not savedCFrame then
        Notify("‚ùå Nenhuma posi√ß√£o salva", "Salve uma posi√ß√£o antes de voltar.", 3)
        return
    end

    backDebounce = true
    spawn(function()
        -- aguarda personagem (√∫til se o jogador foi teleportado e respawnou)
        local char = LocalPlayer.Character
        if not char then
            local r = Players.PlayerAdded:Wait() -- fallback (raro)
            char = LocalPlayer.Character
        end
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then
            -- espera humanoidrootpart por alguns segundos
            local ok = false
            for i = 1, 15 do
                char = LocalPlayer.Character
                if char then
                    hrp = char:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        ok = true
                        break
                    end
                end
                wait(0.08)
            end
            if not hrp then
                Notify("‚ùå Erro", "HumanoidRootPart n√£o encontrado (n√£o foi poss√≠vel teleportar).", 4)
                backDebounce = false
                return
            end
        end

        -- Para minimizar corre√ß√µes do servidor, aplica o CFrame repetidas vezes por um curto per√≠odo
        local attempts = 6
        for i = 1, attempts do
            if hrp and hrp.Parent then
                pcall(function() hrp.CFrame = savedCFrame end)
            end
            wait(0.08)
        end

        Notify("‚Ü© Teleportado", "Voc√™ foi levado para a posi√ß√£o salva.", 3)

        -- pequena espera e mais uma aplica√ß√£o para "fixar"
        wait(0.25)
        if hrp and hrp.Parent then
            pcall(function() hrp.CFrame = savedCFrame end)
        end

        -- mant√©m debounce por 0.7s para evitar duplo clique
        wait(0.7)
        backDebounce = false
    end)
end)

-- trocar abas
btnNext.MouseButton1Click:Connect(function()
    ServerFrame.Visible = false
    SaveFrame.Visible = true
end)
BackToServersBtn.MouseButton1Click:Connect(function()
    SaveFrame.Visible = false
    ServerFrame.Visible = true
end)

-- Ajuste visual final: centraliza elementos em SaveFrame
SaveBtn.Position = UDim2.new(0.5, -180, 0.12, 0)
BackPosBtn.Position = UDim2.new(0.5, -180, 0.12 + 0.18, 0)
BackToServersBtn.Position = UDim2.new(0.5, -80, 0.12 + 0.36, 0)

-- Fim do script
Notify("‚úÖ GUI pronta", "Abra e use a GUI.", 3)
